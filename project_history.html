<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project History</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    h2 {
      color: #004080;
    }
    .filter-box {
      margin-bottom: 20px;
    }
    .filter-box select, .filter-box input {
      padding: 10px;
      margin-right: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #004080;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .view-btn {
      padding: 6px 12px;
      background: #004080;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Project History</h2>
  <div class="filter-box">
    <select id="filterType">
      <option value="customerName">Customer Name</option>
      <option value="channel">Communication Channel</option>
      <option value="ediDocs">EDI Document Types</option>
    </select>
    <input type="text" id="filterInput" placeholder="Enter filter value">
    <button onclick="applyFilter()">üîç Search</button>
    <button onclick="exportCSV()">‚¨áÔ∏è Export</button>
  </div>
  <table id="historyTable">
    <thead>
      <tr>
        <th>Project Title</th>
        <th>Customer</th>
        <th>Channel</th>
        <th>EDI Docs</th>
        <th>Start Date</th>
        <th>Go-Live Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="historyBody">
      <!-- Rows will be populated dynamically -->
    </tbody>
  </table>

  <script>
    const projectData = JSON.parse(localStorage.getItem('projectHistory') || '[]');

    function renderTable(data) {
      const tbody = document.getElementById('historyBody');
      tbody.innerHTML = '';
      data.forEach((item, i) => {
        const row = `
          <tr>
            <td>${item.projectTitle}</td>
            <td>${item.customerName}</td>
            <td>${item.channel}</td>
            <td>${item.ediDocs}</td>
            <td>${item.startDate}</td>
            <td>${item.goLiveDate}</td>
            <td><button class="view-btn" onclick='viewDetails(${i})'>View</button></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }

    function applyFilter() {
      const type = document.getElementById('filterType').value;
      const keyword = document.getElementById('filterInput').value.toLowerCase();
      const filtered = projectData.filter(p => p[type].toLowerCase().includes(keyword));
      renderTable(filtered);
    }

    function viewDetails(index) {
      const data = projectData[index];
      alert(`Project: ${data.projectTitle}\nCustomer: ${data.customerName}\nEDI Docs: ${data.ediDocs}`);
    }

    function exportCSV() {
      const headers = ['Project Title','Customer','Channel','EDI Docs','Start Date','Go-Live Date'];
      const rows = projectData.map(p => [p.projectTitle, p.customerName, p.channel, p.ediDocs, p.startDate, p.goLiveDate]);
      let csv = headers.join(',') + '\n' + rows.map(r => r.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'project_history.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    renderTable(projectData);
  </script>
</body>
</html>
